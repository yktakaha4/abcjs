<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Synthesized Sound | abcjs</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="JavaScript library for displaying sheet music in a browser.">
    <link rel="preload" href="/abcjs/assets/css/0.styles.0a0de2ed.css" as="style"><link rel="preload" href="/abcjs/assets/js/app.16ae2c04.js" as="script"><link rel="preload" href="/abcjs/assets/js/4.e133f8a4.js" as="script"><link rel="preload" href="/abcjs/assets/js/20.2a9b0f8d.js" as="script"><link rel="prefetch" href="/abcjs/assets/js/1.ecd11f93.js"><link rel="prefetch" href="/abcjs/assets/js/10.1e746f6b.js"><link rel="prefetch" href="/abcjs/assets/js/11.624acb6b.js"><link rel="prefetch" href="/abcjs/assets/js/12.3a5d71bf.js"><link rel="prefetch" href="/abcjs/assets/js/13.4d894da2.js"><link rel="prefetch" href="/abcjs/assets/js/14.ee6e7b98.js"><link rel="prefetch" href="/abcjs/assets/js/15.4229ca8b.js"><link rel="prefetch" href="/abcjs/assets/js/16.5c8c02c9.js"><link rel="prefetch" href="/abcjs/assets/js/17.093f4c6e.js"><link rel="prefetch" href="/abcjs/assets/js/18.89649559.js"><link rel="prefetch" href="/abcjs/assets/js/19.1f83564d.js"><link rel="prefetch" href="/abcjs/assets/js/2.09eef6c6.js"><link rel="prefetch" href="/abcjs/assets/js/21.1bc15009.js"><link rel="prefetch" href="/abcjs/assets/js/22.a319dd0e.js"><link rel="prefetch" href="/abcjs/assets/js/23.7d3e5ab0.js"><link rel="prefetch" href="/abcjs/assets/js/24.ff86ed32.js"><link rel="prefetch" href="/abcjs/assets/js/25.ab56f75e.js"><link rel="prefetch" href="/abcjs/assets/js/26.b390efb0.js"><link rel="prefetch" href="/abcjs/assets/js/27.9fcf5c55.js"><link rel="prefetch" href="/abcjs/assets/js/28.0164cdc9.js"><link rel="prefetch" href="/abcjs/assets/js/29.e8355ec7.js"><link rel="prefetch" href="/abcjs/assets/js/30.79104982.js"><link rel="prefetch" href="/abcjs/assets/js/31.a4ff18a2.js"><link rel="prefetch" href="/abcjs/assets/js/32.09b9d8b7.js"><link rel="prefetch" href="/abcjs/assets/js/33.adb3beee.js"><link rel="prefetch" href="/abcjs/assets/js/34.fca13930.js"><link rel="prefetch" href="/abcjs/assets/js/35.6f4067d1.js"><link rel="prefetch" href="/abcjs/assets/js/36.7a6eed21.js"><link rel="prefetch" href="/abcjs/assets/js/37.638405f4.js"><link rel="prefetch" href="/abcjs/assets/js/38.c830ff30.js"><link rel="prefetch" href="/abcjs/assets/js/5.4ac322c8.js"><link rel="prefetch" href="/abcjs/assets/js/6.e6afa5e6.js"><link rel="prefetch" href="/abcjs/assets/js/7.cdaccca3.js"><link rel="prefetch" href="/abcjs/assets/js/8.b6caa845.js"><link rel="prefetch" href="/abcjs/assets/js/9.0851c050.js">
    <link rel="stylesheet" href="/abcjs/assets/css/0.styles.0a0de2ed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/abcjs/" class="home-link router-link-active"><img src="/abcjs/img/abcjs_comp_extended_08.svg" alt="abcjs" class="logo"> <span class="site-name can-hide">abcjs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Visual</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Audio</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/abcjs/audio/synthesized-sound.html" aria-current="page" class="active sidebar-link">Synthesized Sound</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/abcjs/audio/synthesized-sound.html#browser-compatibility-and-requirements" class="sidebar-link">Browser Compatibility and Requirements</a></li><li class="sidebar-sub-header"><a href="/abcjs/audio/synthesized-sound.html#theory" class="sidebar-link">Theory</a></li><li class="sidebar-sub-header"><a href="/abcjs/audio/synthesized-sound.html#examples" class="sidebar-link">Examples</a></li><li class="sidebar-sub-header"><a href="/abcjs/audio/synthesized-sound.html#api" class="sidebar-link">API</a></li><li class="sidebar-sub-header"><a href="/abcjs/audio/synthesized-sound.html#synth-createsynth" class="sidebar-link">synth.CreateSynth</a></li><li class="sidebar-sub-header"><a href="/abcjs/audio/synthesized-sound.html#synth-synthcontroller" class="sidebar-link">synth.SynthController</a></li><li class="sidebar-sub-header"><a href="/abcjs/audio/synthesized-sound.html#synth-getmidifile-abcstring-options" class="sidebar-link">synth.getMidiFile(abcString, options)</a></li><li class="sidebar-sub-header"><a href="/abcjs/audio/synthesized-sound.html#synth-createsynthcontrol" class="sidebar-link">synth.CreateSynthControl</a></li><li class="sidebar-sub-header"><a href="/abcjs/audio/synthesized-sound.html#synth-synthsequence" class="sidebar-link">synth.SynthSequence</a></li><li class="sidebar-sub-header"><a href="/abcjs/audio/synthesized-sound.html#cursorcontrol-object" class="sidebar-link">CursorControl object</a></li><li class="sidebar-sub-header"><a href="/abcjs/audio/synthesized-sound.html#synth-playevent-pitches-gracenotes-millisecondspermeasure" class="sidebar-link">synth.playEvent(pitches, gracenotes, millisecondsPerMeasure)</a></li><li class="sidebar-sub-header"><a href="/abcjs/audio/synthesized-sound.html#synth-activeaudiocontext" class="sidebar-link">synth.activeAudioContext()</a></li><li class="sidebar-sub-header"><a href="/abcjs/audio/synthesized-sound.html#synth-instrumentindextoname-index" class="sidebar-link">synth.instrumentIndexToName[index]</a></li><li class="sidebar-sub-header"><a href="/abcjs/audio/synthesized-sound.html#synth-pitchtonotename-pitchnumber" class="sidebar-link">synth.pitchToNoteName[pitchNumber]</a></li><li class="sidebar-sub-header"><a href="/abcjs/audio/synthesized-sound.html#tempos" class="sidebar-link">Tempos</a></li><li class="sidebar-sub-header"><a href="/abcjs/audio/synthesized-sound.html#drum-parameter" class="sidebar-link">Drum parameter</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Animation</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Interactive</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Analysis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Deprecated</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Developers</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Upgrading</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="synthesized-sound"><a href="#synthesized-sound" class="header-anchor">#</a> Synthesized Sound</h1> <h2 id="browser-compatibility-and-requirements"><a href="#browser-compatibility-and-requirements" class="header-anchor">#</a> Browser Compatibility and Requirements</h2> <ul><li><p>This works in any browser that supports <code>AudioContext</code>, <code>AudioContext.resume</code>, and <code>Promises</code>. That does NOT include IE, but this will work on any other &quot;modern&quot; browser that is at least the following version: Firefox 40, Safari 9.1, Edge 13, and Chrome 43.</p></li> <li><p>This requires an internet connection for the &quot;sound fonts&quot;. You can supply your own sound fonts, so if you want to deliver them locally you can get by without the network. The default sound fonts come from <a href="https://paulrosen.github.io/midi-js-soundfonts" target="_blank" rel="noopener noreferrer">this github repo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></li> <li><p>It is theoretically possible to create complex enough pieces to bog down your browser or eat up memory. The two things that take resources are each unique note in each instrument and the overall length of the music. Music of a few minutes long with a variety of notes in a few different instruments work with no problem on all devices that have been tested.</p></li></ul> <h2 id="theory"><a href="#theory" class="header-anchor">#</a> Theory</h2> <ul><li><p>This creates an audio buffer that is similar to a WAV file and contains the entire piece to play.</p></li> <li><p>The sounds themselves come from a &quot;sound font&quot;: that is, each individual note on each instrument is a separate sound file that is combined into the audio buffer.</p></li> <li><p>The instrument numbers and the pitch numbers come from the MIDI spec. MIDI is not produced, but it is MIDI-like.</p></li></ul> <h2 id="examples"><a href="#examples" class="header-anchor">#</a> Examples</h2> <p>See <a href="https://raw.githubusercontent.com/paulrosen/abcjs/master/examples/basic-synth.html" target="_blank" rel="noopener noreferrer">Basic Synth<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for the simplest possible way of making sound.</p> <p>See <a href="https://raw.githubusercontent.com/paulrosen/abcjs/master/examples/full-synth.html" target="_blank" rel="noopener noreferrer">Full Synth<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for an example that incorporates a bouncing-ball type animation and an audio control.</p> <h2 id="api"><a href="#api" class="header-anchor">#</a> API</h2> <p>Since there are a number of ways to use the synthesized sound: with or without a visual depiction of the tune, with or without a user-facing audio control, and with or without various timing callbacks, there are a number of different entry points.</p> <h2 id="synth-createsynth"><a href="#synth-createsynth" class="header-anchor">#</a> synth.CreateSynth</h2> <p>Creates the object that does all the work of creating and playing the audio. It is the only object you need to create an audio widget for the user to control the sound.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> synth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ABCJS<span class="token punctuation">.</span>synth<span class="token punctuation">.</span>CreateSynth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="init-synthoptions"><a href="#init-synthoptions" class="header-anchor">#</a> init(synthOptions)</h3> <p>The first call that must be made on the CreateSynth object. This will load all of the needed notes and will return a promise when they are loaded. There might be a considerable delay for this to finish. Because the notes are cached, though, the second time CreateSynth is created with a piece of music with similar notes, it will take much less time. See below for the synthOptions.</p> <p>This must not be called until the user has made a gesture on the page because this references an <code>AudioContext</code>.</p> <p>This returns a promise after all the notes have been loaded.</p> <h4 id="synthoptions"><a href="#synthoptions" class="header-anchor">#</a> synthOptions</h4> <table><thead><tr><th>Attribute</th> <th>Default</th> <th>Description</th></tr></thead> <tbody><tr><td>audioContext</td> <td>undefined</td> <td>This the value of <code>new AudioContext()</code>. It should be passed in instead of created because the calling program might be managing and reusing this. It also MUST be creating in the handler of a user action. It can't be created at any other time. But if you don't pass one in then abcjs will create it. This value is cached for the length of the browser session.</td></tr> <tr><td>visualObj</td> <td>undefined</td> <td>This is the result of <code>renderAbc()</code>. Important: <code>renderAbc()</code> returns an array, since an ABC string can contain more than one tune. This variable is just one element in that array. Either this must be supplied, or <code>sequence</code> must be supplied.</td></tr> <tr><td>sequence</td> <td>undefined</td> <td>This is a manually-created set of instructions for creating the audio. It is built using the <code>SynthSequence</code> object.</td></tr> <tr><td>millisecondsPerMeasure</td> <td>calculated</td> <td>This allows control over the tempo. If this is present, then the tempo specified in the ABC string is ignored.</td></tr> <tr><td>debugCallback</td> <td>undefined</td> <td>This will be called with various extra info at different times in the process.</td></tr> <tr><td>options</td> <td>undefined</td> <td>Some options for the sound creation (see list below).</td></tr></tbody></table> <h4 id="synthoptions-options"><a href="#synthoptions-options" class="header-anchor">#</a> synthOptions.options</h4> <p>In addition to the following option, you can also set the options described in audioParams below.</p> <table><thead><tr><th>Attribute</th> <th>Default</th> <th>Description</th></tr></thead> <tbody><tr><td>soundFontUrl</td> <td>&quot;https://paulrosen.github.io/midi-js-soundfonts/abcjs/&quot;</td> <td>This is the public URL for the sound font. If it isn't present, then the sound fonts come from the github repo. This can be replaced if the new sound font follows the same format.</td></tr> <tr><td>soundFontVolumeMultiplier</td> <td>1.0</td> <td>This is the amount to multiply all the volumes to compensate for different volume soundfonts. If you find that either the volume is too low or the output is clipped, you can experiment with this number.</td></tr> <tr><td>programOffsets</td> <td>{}</td> <td>The offset of each voice to the beat. Some voices have a ramp up time so that the beginning of the sound isn't the beat. This is the number of milliseconds that the program should be offset. This is expressed as <code>{ 'program_name': 100 }</code> where the program name is one of the standard midi names, like &quot;acoustic_grand_piano&quot;. If you use the default soundfont then these values are set automatically. You can still provide this parameter to override the settings if you like.</td></tr> <tr><td>sequenceCallback</td> <td>undefined</td> <td>This is called after the array of notes is created, and just before it is used to create the audio buffer. The array of tracks is passed in, and this gives a chance to tweak the audio before it is created: you can give it some swing, you can change volumes, or anything else.</td></tr> <tr><td>callbackContext</td> <td>undefined</td> <td>This is passed back when the sequenceCallback function is called.</td></tr> <tr><td>onEnded</td> <td>undefined</td> <td>This function is called after the playback stops.</td></tr> <tr><td>pan</td> <td>[0...]</td> <td>An array of numbers between -1 and 1 for how far to pan each track. -1 is all the way to the left and 1 is all the way to the right. If there are not enough items in the array for all the tracks, then the remaining tracks will be in the middle.</td></tr></tbody></table> <h4 id="example"><a href="#example" class="header-anchor">#</a> Example</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> myContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AudioContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> visualObj <span class="token operator">=</span> <span class="token constant">ABCJS</span><span class="token punctuation">.</span><span class="token function">renderAbc</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
synth<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    audioContext<span class="token operator">:</span> myContext<span class="token punctuation">,</span>
    visualObj<span class="token operator">:</span> visualObj<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    millisecondsPerMeasure<span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
        soundFontUrl<span class="token operator">:</span> <span class="token string">&quot;https:/path/to/soundfont/folder&quot;</span><span class="token punctuation">,</span>
        pan<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.3</span> <span class="token punctuation">]</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">results</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Ready to play. The results are details about what was loaded.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The above will:</p> <ol><li>create audio for the first tune found in the tunebook that is passed to <code>renderAbc</code>.</li> <li>It will play at 1/2 second per measure (180 bpm for 2/4 time).</li> <li>It will use the URL provided for the soundfont.</li> <li>It will put the first track a little bit to the left side and the second track a little bit to the right. (Note that if the music is a single line of music with chord diagrams, the melody will be track 0 and the chords will be track 1.)</li></ol> <h3 id="prime"><a href="#prime" class="header-anchor">#</a> prime()</h3> <p>This creates the actual buffer - it doesn't require a network connection since all the notes have now been preloaded. It returns a promise because there might be a little bit of time delay doing the calculations.</p> <p>After calling this, everything is setup so you can freely call the rest of the functions to control how the audio works.</p> <h4 id="example-2"><a href="#example-2" class="header-anchor">#</a> Example</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>synth<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    synth<span class="token punctuation">.</span><span class="token function">prime</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="start"><a href="#start" class="header-anchor">#</a> start()</h3> <p>This starts the audio.</p> <p>Call this after <code>prime()</code> has returned its promise. This will happen fast and doesn't have any latency, so you can call this right as you are timing other things to be in sync with the audio.</p> <h3 id="pause-and-resume"><a href="#pause-and-resume" class="header-anchor">#</a> pause() and resume()</h3> <p>After <code>start()</code> has been called, pause and resume can be called to control the playback.</p> <h3 id="seek-percent"><a href="#seek-percent" class="header-anchor">#</a> seek(percent)</h3> <p>This changes the playback position. It can be called whether the sound is currently playing or not. The percent is a number between 0 and 1.</p> <h3 id="stop"><a href="#stop" class="header-anchor">#</a> stop()</h3> <p>Stops playing the sound and resets the progress to the beginning of the sound file.</p> <h3 id="download"><a href="#download" class="header-anchor">#</a> download()</h3> <p>This returns the audio buffer created. (It is in WAV format.)</p> <h2 id="synth-synthcontroller"><a href="#synth-synthcontroller" class="header-anchor">#</a> synth.SynthController</h2> <p>Creates the object that handles the visual part of the control. This creates play and stop buttons, etc. See the section below for the options.</p> <p>The constructor can be called at any time, including before much is initialized:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> synthControl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ABCJS<span class="token punctuation">.</span>synth<span class="token punctuation">.</span>SynthController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="load-selector-cursorcontrol-visualoptions"><a href="#load-selector-cursorcontrol-visualoptions" class="header-anchor">#</a> load(selector, cursorControl, visualOptions)</h3> <p>After the DOM is loaded, this should be called to initialize the visual widget that contains the &quot;play&quot;, etc. buttons.</p> <p>While this can be called multiple times, it is generally just called once during initialization.</p> <h4 id="selector"><a href="#selector" class="header-anchor">#</a> selector</h4> <p>This is a CSS-style selector of the element that should be turned into the audio control.</p> <h4 id="cursorcontrol"><a href="#cursorcontrol" class="header-anchor">#</a> cursorControl</h4> <p>This is an optional object that can be passed in that will receive callbacks when events happen that should move the cursor. See the section on &quot;CursorControl&quot; for more info.</p> <h4 id="visualoptions"><a href="#visualoptions" class="header-anchor">#</a> visualOptions</h4> <p>This is a hash with the following possible properties:</p> <table><thead><tr><th>Option</th> <th>Default</th> <th>Description</th></tr></thead> <tbody><tr><td>displayLoop</td> <td>false</td> <td>Whether to display a button that the user can press to make the tune loop instead of stopping when it gets to the end.</td></tr> <tr><td>displayRestart</td> <td>false</td> <td>Whether to display a button that the user can press to make the tune go back to the beginning.</td></tr> <tr><td>displayPlay</td> <td>false</td> <td>Whether to display a button that the user can press to make the tune start playing. (Note: this turns into the &quot;pause&quot; button when the tune is playing.)</td></tr> <tr><td>displayProgress</td> <td>false</td> <td>Whether to display the progress slider. The user can click anywhere on this to get the music to jump to that location.</td></tr> <tr><td>displayWarp</td> <td>false</td> <td>Whether to display the tempo and allow the user to change it on the fly.</td></tr></tbody></table> <h3 id="settune-visualobj-useraction-audioparams"><a href="#settune-visualobj-useraction-audioparams" class="header-anchor">#</a> setTune(visualObj, userAction, audioParams)</h3> <p>This is called whenever there is a new tune ready to be loaded into the player.</p> <h4 id="visualobj"><a href="#visualobj" class="header-anchor">#</a> visualObj</h4> <p>This is one of the tunes that is returned from the <code>renderAbc()</code> call. That is, <code>renderAbc</code> will return an array of tunes. Often it is an array of length 1 if there is only one tune in the abc string, but it could be multiple tunes.</p> <h4 id="useraction"><a href="#useraction" class="header-anchor">#</a> userAction</h4> <p>True if this is being called inside an event handler from a user gesture. The audio buffer can't be created until then. If this is <code>true</code>, then the audio buffer is created immediately. If this is <code>false</code> then the audio buffer is not created until the user clicks the <code>play</code> button.</p> <h3 id="audioparams"><a href="#audioparams" class="header-anchor">#</a> audioParams</h3> <p>Here are the possible properties that can be passed in:</p> <table><thead><tr><th>Property</th> <th>Default</th> <th>Description</th></tr></thead> <tbody><tr><td>audioContext</td> <td>create it.</td> <td>An AudioContext object so that they can be reused.</td></tr> <tr><td>debugCallback;</td> <td>null</td> <td>A function that is called at various times in the creation of the audio.</td></tr> <tr><td>soundFontUrl</td> <td>use the default</td> <td>The publicly available URL of the soundfont to use.</td></tr> <tr><td>soundFontVolumeMultiplier</td> <td>1.0</td> <td>This is the amount to multiply all the volumes to compensate for different volume soundfonts. If you find that either the volume is too low or the output is clipped, you can experiment with this number.</td></tr> <tr><td>millisecondsPerMeasure</td> <td>calculated</td> <td>An override of the tempo in the tune.</td></tr> <tr><td>visualObj</td> <td>null</td> <td>The object returned from <code>renderAbc</code>.</td></tr> <tr><td>options</td> <td>{}</td> <td>Options to pass to the low-level buffer creation routines.</td></tr> <tr><td>sequence</td> <td>null</td> <td>An alternate audio specification, if visualObj is not present.</td></tr> <tr><td>onEnded</td> <td>null</td> <td>A callback function when the AudioBuffer finishes playing.</td></tr></tbody></table> <p>The <code>options</code> element above can have the following properties:</p> <table><thead><tr><th>Property</th> <th>Default</th> <th>Description</th></tr></thead> <tbody><tr><td>sequenceCallback</td> <td>null</td> <td>A hook to get the instructions that will be passed to the Audio Buffer. This can be used either to debug what audio was generated or to modify the sequence before the audio is created. This can be useful to add &quot;swing&quot; to the beats, or do any other processing that isn't possible in ABC notation.</td></tr> <tr><td>callbackContext</td> <td>null</td> <td>This is passed back with the sequenceCallback. It can be anything you want.</td></tr> <tr><td>program</td> <td>0</td> <td>The midi program (aka &quot;instrument&quot;) to use, if not specified in ABC string.</td></tr> <tr><td>midiTranspose</td> <td>0</td> <td>The number of half-steps to transpose everything, if not specified in ABC string.</td></tr> <tr><td>channel</td> <td>0</td> <td>The &quot;midi channel&quot; to use. This isn't particularly useful except that specifying channel 10 means to use the percussion sounds.</td></tr> <tr><td>drum</td> <td>null</td> <td>Whether to add a drum, or metronome track. A string formatted like the <code>%%MIDI drum</code> specification. Using this parameter also implies <code>%%MIDI drumon</code> See the section for &quot;Drum Parameter&quot; for an explanation.</td></tr> <tr><td>drumBars</td> <td>1</td> <td>How many bars to spread the drum pattern over. See the section for &quot;Drum Parameter&quot; for an explanation.</td></tr> <tr><td>drumIntro</td> <td>0</td> <td>The number of measures of count in beats before the music starts.</td></tr> <tr><td>qpm</td> <td>null</td> <td>The tempo to use. This overrides a tempo that is in the tune.</td></tr> <tr><td>defaultQpm</td> <td>null</td> <td>The tempo to use, only if there is no tempo in the tune.</td></tr> <tr><td>chordsOff</td> <td>false</td> <td>If true, then don't turn the guitar chord symbols into sound. (But do play the metronome if there is one.)</td></tr> <tr><td>voicesOff</td> <td>false</td> <td>If true, play the metronome and accompaniment; do the animation callbacks, but don't play any melody lines. This can also be an array of voices to turn off. The voices are numbered starting at zero.</td></tr></tbody></table> <h3 id="play-pause-toggleloop-restart-setprogress-ev"><a href="#play-pause-toggleloop-restart-setprogress-ev" class="header-anchor">#</a> play(), pause(), toggleLoop(), restart(), setProgress(ev)</h3> <p>These do the same thing as the user pressing these buttons, but can be called programmatically.</p> <h3 id="setwarp-percent"><a href="#setwarp-percent" class="header-anchor">#</a> setWarp(percent)</h3> <p>This changes the tempo to the percent passed in. That should be a positive integer. It will change the tempo immediately if the music is already playing.</p> <h3 id="download-filename"><a href="#download-filename" class="header-anchor">#</a> download(fileName)</h3> <p>This will download the current audio buffer as a WAV file to the fileName passed in.</p> <h3 id="example-3"><a href="#example-3" class="header-anchor">#</a> Example</h3> <p>The following creates an audio control that the user can manipulate.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// given that there are two elements in the DOM with the IDs &quot;paper&quot; and &quot;audio&quot;</span>
<span class="token keyword">var</span> cursorControl <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// see section on CursorControl</span>
<span class="token keyword">var</span> abc <span class="token operator">=</span> <span class="token string">&quot;X:1\n etc...&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> abcOptions <span class="token operator">=</span> <span class="token punctuation">{</span> add_classes<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> audioParams <span class="token operator">=</span> <span class="token punctuation">{</span> chordsOff<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">ABCJS</span><span class="token punctuation">.</span>synth<span class="token punctuation">.</span><span class="token function">supportsAudio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> synthControl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ABCJS<span class="token punctuation">.</span>synth<span class="token punctuation">.</span>SynthController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	synthControl<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;#audio&quot;</span><span class="token punctuation">,</span> 
        cursorControl<span class="token punctuation">,</span> 
        <span class="token punctuation">{</span>
            displayLoop<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
            displayRestart<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
            displayPlay<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
            displayProgress<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
            displayWarp<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">var</span> visualObj <span class="token operator">=</span> <span class="token constant">ABCJS</span><span class="token punctuation">.</span><span class="token function">renderAbc</span><span class="token punctuation">(</span><span class="token string">&quot;paper&quot;</span><span class="token punctuation">,</span> 
        abc<span class="token punctuation">,</span> abcOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> createSynth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ABCJS<span class="token punctuation">.</span>synth<span class="token punctuation">.</span>CreateSynth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	createSynth<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span> visualObj<span class="token operator">:</span> visualObj<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		synthControl<span class="token punctuation">.</span><span class="token function">setTune</span><span class="token punctuation">(</span>visualObj<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> audioParams<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Audio successfully loaded.&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;Audio problem:&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;Audio problem:&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#audio&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> 
        <span class="token string">&quot;Audio is not supported in this browser.&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="synth-getmidifile-abcstring-options"><a href="#synth-getmidifile-abcstring-options" class="header-anchor">#</a> synth.getMidiFile(abcString, options)</h2> <p>This is called to get the audio in MIDI format, instead of as a playable audio buffer.</p> <h3 id="abcstring"><a href="#abcstring" class="header-anchor">#</a> abcString</h3> <p>The ABC string to create the MIDI from.</p> <h3 id="options"><a href="#options" class="header-anchor">#</a> options</h3> <p>The same options as are used elsewhere, with the addition of:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>options <span class="token operator">=</span> <span class="token punctuation">{</span>
	midiOutputType<span class="token operator">:</span> <span class="token string">&quot;encoded&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;binary&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;link&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// The following OPTIONAL parameters are only used when the type is &quot;link&quot;:</span>
    downloadClass<span class="token operator">:</span> <span class="token string">&quot;class-name-to-add&quot;</span><span class="token punctuation">,</span>
    preTextDownload<span class="token operator">:</span> <span class="token string">&quot;text that appears before the link&quot;</span><span class="token punctuation">,</span>
    downloadLabel<span class="token operator">:</span> <span class="token string">&quot;the text that appears as the body of the anchor tag that is clickable&quot;</span><span class="token punctuation">,</span>
    postTextDownload<span class="token operator">:</span> <span class="token string">&quot;text that appears after the link&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="midioutputtype"><a href="#midioutputtype" class="header-anchor">#</a> midiOutputType</h4> <p>If this is not present or set to <code>link</code>, then the return value is a link that can be placed directly on the page for the user to download.</p> <p>If this is set to <code>binary</code>, then the actual contents of the midi file are returned, as a blob.</p> <p>If this is set to &quot;encoded&quot;, then the contents of the midi file are returned, as an encoded ASCII string. That is, bytes are represented by <code>%xx</code> where xx is a hexidecimal value.</p> <h4 id="downloadlabel"><a href="#downloadlabel" class="header-anchor">#</a> downloadLabel</h4> <p>If this isn't present, then the title is retrieved from the tune and the label is &quot;Download MIDI for $TITLE&quot;.</p> <p>If you'd like to use the title in the label but modify it, use <code>%T</code>. That is: <code>downloadLabel: &quot;the tune %T is ready for download&quot;</code></p> <h3 id="examples-2"><a href="#examples-2" class="header-anchor">#</a> Examples</h3> <h4 id="complete-download-link"><a href="#complete-download-link" class="header-anchor">#</a> Complete download link</h4> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>midi-link<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> midi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ABCJS<span class="token punctuation">.</span>synth<span class="token punctuation">.</span>getMidiFile</span><span class="token punctuation">(</span><span class="token string">&quot;X:1\nT:Cooley's\netc...&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> chordsOff<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> midiOutputType<span class="token operator">:</span> <span class="token string">&quot;link&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;midi-link&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> midi<span class="token punctuation">;</span>
</code></pre></div><p>That results in the following html:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>midi-link<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>abcjs-download-midi abcjs-midi-0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">download</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cooleys.midi<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data:audio/midi,MThd%00%00%00%06%00%01%00 etc...<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Download MIDI for &quot;Cooley's&quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="the-midi-data-for-your-own-download"><a href="#the-midi-data-for-your-own-download" class="header-anchor">#</a> The midi data for your own download</h4> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>midi-link<span class="token punctuation">&quot;</span></span> <span class="token attr-name">download</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myfile.midi<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>MIDI<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> midi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ABCJS<span class="token punctuation">.</span>synth<span class="token punctuation">.</span>getMidiFile</span><span class="token punctuation">(</span><span class="token string">&quot;X:1\nT:Cooley's\netc...&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> chordsOff<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> midiOutputType<span class="token operator">:</span> <span class="token string">&quot;encoded&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;midi-link&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">,</span> midi<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="actual-midi-file-to-pass-to-another-library"><a href="#actual-midi-file-to-pass-to-another-library" class="header-anchor">#</a> Actual midi file to pass to another library</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> midi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ABCJS<span class="token punctuation">.</span>synth<span class="token punctuation">.</span>getMidiFile</span><span class="token punctuation">(</span><span class="token string">&quot;X:1\nT:Cooley's\netc...&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> chordsOff<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> midiOutputType<span class="token operator">:</span> <span class="token string">&quot;binary&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
otherLibraryMidiPlayer<span class="token punctuation">.</span><span class="token function">loadTune</span><span class="token punctuation">(</span>midi<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="synth-createsynthcontrol"><a href="#synth-createsynthcontrol" class="header-anchor">#</a> synth.CreateSynthControl</h2> <p>Lower level object than <code>SynthController</code> if you want the functionality without the visible control.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> control <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ABCJS<span class="token punctuation">.</span>synth<span class="token punctuation">.</span>CreateSynthControl</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>element</code> is either a string representing a selector of an existing element on the page or a DOM element. The contents of that element are replaced with an audio control.</p> <h3 id="options-parameter"><a href="#options-parameter" class="header-anchor">#</a> options parameter</h3> <table><thead><tr><th>Option</th> <th>Description</th></tr></thead> <tbody><tr><td>loopHandler</td> <td>Callback function when the loop button is clicked. If this is not present, then the loop button is not displayed.</td></tr> <tr><td>restartHandler</td> <td>Callback function when the restart button is clicked. if this is not present, then the restart button is not displayed.</td></tr> <tr><td>playHandler or playPromiseHandler</td> <td>Callback function when the play button is clicked. if this is not present, then the play button is not displayed. If the <code>handler</code> version is present, then it must return a promise.</td></tr> <tr><td>progressHandler</td> <td>Callback function when the progress bar is clicked. if this is not present, then the progress bar is not displayed.</td></tr> <tr><td>warpHandler</td> <td>Callback function when the warp percent is changed. if this is not present, then the warp percent is not displayed.</td></tr> <tr><td>afterResume</td> <td>Callback function after the AudioContext is set up correctly.</td></tr> <tr><td>-------------</td> <td>-------------</td></tr> <tr><td>hasClock</td> <td>Whether to display a clock on the control.</td></tr> <tr><td>ac</td> <td>The AudioContext to use for this control. (Optional - if this is not present, then a button will appear asking the user to click to get an AudioContext.)</td></tr> <tr><td>-------------</td> <td>-------------</td></tr> <tr><td>repeatTitle</td> <td>To override the text of the tooltip for toggling loop mode.</td></tr> <tr><td>repeatAria</td> <td>To override the text of the aria for loop mode. (By default, the repeatTitle is used.)</td></tr> <tr><td>restartTitle</td> <td>To override the text of the tooltip for the restart button.</td></tr> <tr><td>restartAria</td> <td>To override the text of the aria for restart mode. (By default, the restartTitle is used.)</td></tr> <tr><td>playTitle</td> <td>To override the text of the tooltip for the play/pause button.</td></tr> <tr><td>playAria</td> <td>To override the text of the aria for the play/pause. (By default, the playTitle is used.)</td></tr> <tr><td>randomTitle</td> <td>To override the text of the tooltip for the progress slider.</td></tr> <tr><td>randomAria</td> <td>To override the text of the aria for progress slider. (By default, the randomTitle is used.)</td></tr> <tr><td>warpTitle</td> <td>To override the text of the tooltip for the warp input.</td></tr> <tr><td>warpAria</td> <td>To override the text of the aria for warp input. (By default, the warpTitle is used.)</td></tr> <tr><td>bpm</td> <td>To override the text &quot;BPM&quot; for beats per minute.</td></tr></tbody></table> <h2 id="synth-synthsequence"><a href="#synth-synthsequence" class="header-anchor">#</a> synth.SynthSequence</h2> <p>Creates an object that builds data for <code>CreateSynth</code>. This is normally done internally if <code>CreateSynth</code> is passed a visual object, but this is a way to custom build any sequence.</p> <p>This is a helper object that will create an object that is consumed by <code>CreateSynth</code>. There is nothing special about this that you couldn't create the object by hand, but this provides some convenience functions.</p> <table><thead><tr><th>Method</th> <th>Parameters</th> <th>Description</th></tr></thead> <tbody><tr><td><code>addTrack</code></td> <td>(none)</td> <td>Returns the number of the track that was created. This must be called before anything can be added to the track.</td></tr> <tr><td><code>setInstrument</code></td> <td><code>trackNumber, instrumentNumber</code></td> <td><code>trackNumber</code> is the value that is returned by <code>addTrack</code>. instrumentNumber is the stand MIDI number for the instrument. (See <code>ABCJS.synth.instrumentIndexToName</code> for the list of instruments.) This should be called right after <code>addTrack</code> and may be called at any time after that to change the instrument midstream.</td></tr> <tr><td><code>appendNote</code></td> <td><code>trackNumber, pitch, durationInMeasures, volume</code></td> <td>This adds a note. <code>trackNumber</code> is the value returned from <code>addTrack</code>. <code>pitch</code> is the standard midi pitch number. <code>durationInMeasures</code> is a floating point number where &quot;1&quot; is one measure. <code>volume</code> is a value from 0 to 255 that is the volume of the note.</td></tr></tbody></table> <h2 id="cursorcontrol-object"><a href="#cursorcontrol-object" class="header-anchor">#</a> CursorControl object</h2> <p>If you want notification when events happen, then you can pass in an object that you create yourself. The following properties are used:</p> <h3 id="beatsubdivisions"><a href="#beatsubdivisions" class="header-anchor">#</a> beatSubdivisions</h3> <p>How often to call the beat callback. If this is not set, then the beat callback is called once per beat. If you want a finer grained control, you can set this to a larger number. Notice that a large number will affect performance.</p> <h3 id="extrameasuresatbeginning"><a href="#extrameasuresatbeginning" class="header-anchor">#</a> extraMeasuresAtBeginning</h3> <p>How many extra measures to have at the beginning before the tune actually starts. This can be used for count in beats.</p> <h3 id="lineendanticipation"><a href="#lineendanticipation" class="header-anchor">#</a> lineEndAnticipation</h3> <p>When to call the onLineEnd event. If you want to scroll the music when the end of the line is reached, then you probably want to scroll it a little in advance so the user can read ahead. This is the number of milliseconds, so the value of 500 means to scroll the music one half second before the end of the line.</p> <h3 id="onready-synthcontroller"><a href="#onready-synthcontroller" class="header-anchor">#</a> onReady(synthController)</h3> <p>Called when the tune has actually been loaded. Because the audio buffer can only be initialized after a user gesture, the tune might not have been loaded when the visual control is created. This might be called when <code>setTune</code> is called, or when the user clicks PLAY.</p> <p>The parameter is the instance of the synthController that called it.</p> <h3 id="onstart"><a href="#onstart" class="header-anchor">#</a> onStart()</h3> <p>Called when the tune has actually started: that is, after all the set up has been completed.</p> <h3 id="onfinished"><a href="#onfinished" class="header-anchor">#</a> onFinished()</h3> <p>Called when the tune has finished.</p> <h3 id="onbeat-beatnumber-totalbeats-totaltime"><a href="#onbeat-beatnumber-totalbeats-totaltime" class="header-anchor">#</a> onBeat(beatNumber, totalBeats, totalTime)</h3> <p>Called each beat, or each subdivision of a beat.</p> <h4 id="beatnumber"><a href="#beatnumber" class="header-anchor">#</a> beatNumber</h4> <p>This is the current beat - in a perfect case, this is called regularly. There are various things that can cause JavaScript to stop running, though, so it might get called a bunch of times in a row to catch up. This can be a fraction, if <code>beatSubdivisions</code> is present.</p> <h3 id="onevent-event"><a href="#onevent-event" class="header-anchor">#</a> onEvent(event)</h3> <p>This is called every time a note, rest, or bar is encountered.</p> <p>The <code>event</code> parameter has these properties:</p> <table><thead><tr><th>Property</th> <th>Description</th></tr></thead> <tbody><tr><td>measureStart</td> <td><code>true</code> if this is the beginning of a measure. (Note, beware of the case where the only event at the beginning of a measure is a note tied from a previous note. There might not be anything to do.)</td></tr> <tr><td>elements</td> <td>The actual SVG elements that represent the note(s) being played.</td></tr> <tr><td>left</td> <td>The leftmost point of the current elements.</td></tr> <tr><td>top</td> <td>The topmost point of the current elements.</td></tr> <tr><td>height</td> <td>The height of the current elements.</td></tr> <tr><td>width</td> <td>the width of the current elements.</td></tr></tbody></table> <h3 id="onlineend-data"><a href="#onlineend-data" class="header-anchor">#</a> onLineEnd(data)</h3> <p>This is called when the end of the line is approaching. The data is the following properties:</p> <table><thead><tr><th>Property</th> <th>Description</th></tr></thead> <tbody><tr><td>milliseconds</td> <td>The current time.</td></tr> <tr><td>top</td> <td>The top of the current line.</td></tr> <tr><td>bottom</td> <td>The bottom of the current line.</td></tr></tbody></table> <p>Use this to determine if the SVG should be scrolled.</p> <h2 id="synth-playevent-pitches-gracenotes-millisecondspermeasure"><a href="#synth-playevent-pitches-gracenotes-millisecondspermeasure" class="header-anchor">#</a> synth.playEvent(pitches, gracenotes, millisecondsPerMeasure)</h2> <p>This will play a single event that is passed. The event must have the same format as the events that are passed back by the click listener.</p> <h3 id="pitches"><a href="#pitches" class="header-anchor">#</a> pitches</h3> <p>An array of pitches. If there is more than one item in the array, they are played at the same time. Pitches contain:</p> <table><thead><tr><th>Attribute</th> <th>Description</th></tr></thead> <tbody><tr><td>pitch</td> <td>An integer value of the pitch, where middle C is 60</td></tr> <tr><td>durationInMeasures</td> <td>The length of the note. For instance, a quarter note in 4/4 would be .25</td></tr> <tr><td>volume</td> <td>A number from 0 to 127 for the volume of the note.</td></tr> <tr><td>instrument</td> <td>The number of the instrument in the MIDI spec.</td></tr></tbody></table> <h3 id="gracenotes"><a href="#gracenotes" class="header-anchor">#</a> gracenotes</h3> <p>These are the same format as above, except that these notes are played before the main note for a short time. Also, if there is more than one note in the array, the notes are played sequentially.</p> <h3 id="millisecondspermeasure"><a href="#millisecondspermeasure" class="header-anchor">#</a> millisecondsPerMeasure</h3> <p>This is used to translate the <code>durationInMeasures</code> value into an actual time.</p> <h3 id="example-4"><a href="#example-4" class="header-anchor">#</a> Example:</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token constant">ABCJS</span><span class="token punctuation">.</span>synth<span class="token punctuation">.</span><span class="token function">playEvent</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">67</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// a C chord</span>
    <span class="token punctuation">[</span> <span class="token number">62</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// start with a D as a grace note</span>
    <span class="token number">1000</span> <span class="token comment">// a measure takes one second.    </span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;note played&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error playing note&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="synth-activeaudiocontext"><a href="#synth-activeaudiocontext" class="header-anchor">#</a> synth.activeAudioContext()</h2> <p>If there is an AudioContext that is being used then this retrieves it. It allows freely sharing the same one in different parts of your app.</p> <h2 id="synth-instrumentindextoname-index"><a href="#synth-instrumentindextoname-index" class="header-anchor">#</a> synth.instrumentIndexToName[index]</h2> <p>This is an array that converts the standard MIDI instrument indexes to a name. For instance:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">ABCJS</span><span class="token punctuation">.</span>synth<span class="token punctuation">.</span>instrumentIndexToName<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// &quot;glockenspiel&quot;</span>
</code></pre></div><h2 id="synth-pitchtonotename-pitchnumber"><a href="#synth-pitchtonotename-pitchnumber" class="header-anchor">#</a> synth.pitchToNoteName[pitchNumber]</h2> <p>This is an array that converts the standard MIDI pitch indexes to a name. For instance:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">ABCJS</span><span class="token punctuation">.</span>synth<span class="token punctuation">.</span>pitchToNoteName<span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// &quot;C4&quot;</span>
</code></pre></div><h2 id="tempos"><a href="#tempos" class="header-anchor">#</a> Tempos</h2> <p>If the <code>qpm</code> parameter is not supplied, abcjs makes its best guess about what tempo should be used. If there is no tempo indicated at all in the ABC string, then 180 BPM is arbitrarily used. If <code>defaultQpm</code> is supplied, then that default will be used only if there is no explicit tempo.</p> <p>If an exact tempo line is supplied with the <code>Q:</code> line, then that tempo is used. If the <code>Q:</code> contains a standard tempo string, that string is used to make a guess at an appropriate tempo. Here is a list of the known tempo strings and their associated tempos. If you would like to make suggestions about other strings to support or changes to these tempos, please get in touch:</p> <table><thead><tr><th>Tempo</th> <th>BPM</th></tr></thead> <tbody><tr><td>larghissimo</td> <td>20</td></tr> <tr><td>adagissimo</td> <td>24</td></tr> <tr><td>sostenuto</td> <td>28</td></tr> <tr><td>grave</td> <td>32</td></tr> <tr><td>largo</td> <td>40</td></tr> <tr><td>lento</td> <td>50</td></tr> <tr><td>larghetto</td> <td>60</td></tr> <tr><td>adagio</td> <td>68</td></tr> <tr><td>adagietto</td> <td>74</td></tr> <tr><td>andante</td> <td>80</td></tr> <tr><td>andantino</td> <td>88</td></tr> <tr><td>marcia moderato</td> <td>84</td></tr> <tr><td>andante moderato</td> <td>100</td></tr> <tr><td>moderato</td> <td>112</td></tr> <tr><td>allegretto</td> <td>116</td></tr> <tr><td>allegro moderato</td> <td>120</td></tr> <tr><td>allegro</td> <td>126</td></tr> <tr><td>animato</td> <td>132</td></tr> <tr><td>agitato</td> <td>140</td></tr> <tr><td>veloce</td> <td>148</td></tr> <tr><td>mosso vivo</td> <td>156</td></tr> <tr><td>vivace</td> <td>164</td></tr> <tr><td>vivacissimo</td> <td>172</td></tr> <tr><td>allegrissimo</td> <td>176</td></tr> <tr><td>presto</td> <td>184</td></tr> <tr><td>prestissimo</td> <td>210</td></tr></tbody></table> <h2 id="drum-parameter"><a href="#drum-parameter" class="header-anchor">#</a> Drum parameter</h2> <p>See the ABC documentation for the correct way to format the string that is passed as the drum parameter. Here is a table that provides a fairly reasonable default for drum, drumIntro, and drumBars when used as a metronome:</p> <div class="language- extra-class"><pre class="language-text"><code>  const drumBeats = {
    // the array is [0]=drum [1]=drumIntro
    &quot;2/4&quot;: [&quot;dd 76 77 60 30&quot;, 2],
    &quot;3/4&quot;: [&quot;ddd 76 77 77 60 30 30&quot;, 1],
    &quot;4/4&quot;: [&quot;dddd 76 77 77 77 60 30 30 30&quot;, 1],
    &quot;5/4&quot;: [&quot;ddddd 76 77 77 76 77 60 30 30 60 30&quot;, 1],
    &quot;Cut Time&quot;: [&quot;dd 76 77 60 30&quot;, 2],
    &quot;6/8&quot;: [&quot;dd 76 77 60 30&quot;, 2],
    &quot;9/8&quot;: [&quot;ddd 76 77 77 60 30 30&quot;, 1],
    &quot;12/8&quot;: [&quot;dddd 76 77 77 77 60 30 30 30&quot;, 1]
  };
</code></pre></div><p>A more complicated example that has the drum pattern fall over two measures of 2/4 time (This is a typical Bulgar pattern):</p> <div class="language- extra-class"><pre class="language-text"><code>{ drum: &quot;d2dd2ddz&quot;, drumBars: 2, drumIntro: 2 }
</code></pre></div><p>Note that the default soundfont that is used by abcjs contains sounds for pitches <strong>27</strong> through <strong>87</strong>. You can experiment with any of them for different effects.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/abcjs/visual/dragging.html" class="prev">
        Selecting and Dragging Elements
      </a></span> <span class="next"><a href="/abcjs/animation/timing-callbacks.html">
        Timing Callbacks
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/abcjs/assets/js/app.16ae2c04.js" defer></script><script src="/abcjs/assets/js/4.e133f8a4.js" defer></script><script src="/abcjs/assets/js/20.2a9b0f8d.js" defer></script>
  </body>
</html>
